import{I as M,c as S,d as v,e as g,k as A,p as w}from"./chunk-SOYNARJ7.js";import{$ as o,J as h,V as s,W as d,Y as y}from"./chunk-QWAF5HSH.js";import"./chunk-KT7KMEQC.js";var K=y([[s.A,2,-32],[s.B,2,-64],[s.LEFT,1,-16],[s.RIGHT,1,-32],[s.UP,1,-64],[s.DOWN,1,-128],[s.START,2,-16],[s.P2_START,3,-32],[s.SELECT,3,8]]),c=15468e3,P=262,D=224;var I=240,b=c/8,R=c/3/P,j=R/328,U=b/R,_=500,q=b/(2*_),T=2,G=60*P,r=class extends w{constructor(){super();this.cpuFrequency=c/8;this.canvasWidth=256;this.numTotalScanlines=262;this.numVisibleScanlines=224;this.defaultROMSize=16448;this.sampleRate=G*T;this.cpuCyclesPerLine=U|0;this.rotate=-90;this.cpu=new S;this.ram=new Uint8Array(4096);this.read=o([[0,32767,16383,e=>this.rom?this.rom[e]:null],[32768,65535,4095,e=>this.ram[e]]]);this.write=o([[32768,65535,4095,(e,t)=>{this.ram[e]=t}]]);this.connectCPUMemoryBus(this),this.connectCPUIOBus(this.newIOBus()),this.inputs.set([255,255,255,247]),this.display=new f,this.handler=d(this.inputs,K,this.getKeyboardFunction()),this.psg=new g(new v),this.audioadapter=new A(this.psg.psg,T,this.sampleRate)}getKeyboardFunction(){return e=>{e.index==3&&e.mask==8&&(this.cpu.reset(),console.log("coin inserted"),console.log(this.inputs))}}newIOBus(){return{read:e=>this.inputs[e&3],write:(e,t)=>{e&1&&this.psg.selectRegister(t&15),e&2&&this.psg.setData(t),e&8,e&64&&(this.display.palbank=t&3)}}}reset(){super.reset(),this.psg.reset()}startScanline(){this.inputs[2]&=-9,this.inputs[2]|=(this.frameCycles/q&1)<<3,this.scanline==D&&(this.inputs[1]|=8),this.scanline==I&&(this.inputs[1]&=-9),this.audio&&this.audioadapter.generate(this.audio)}drawScanline(){this.display.drawScanline(this.ram,this.pixels,this.scanline)}loadROM(e){super.loadROM(e),e.length>=16416&&(e[16384]||e[16415])&&(this.display.colorprom=e.slice(16384,16416))}loadState(e){super.loadState(e),this.display.palbank=e.pb}saveState(){var e=super.saveState();return e.pb=this.display.palbank,e}},f=class{constructor(){this.palbank=0;this.palette=[4278190080,4278190335,4278255360,4278255615,4294901760,4294902015,4294967040,4294967295];this.colorprom=[224,96,32,96,192,96,64,192,32,64,96,128,160,192,224,14,224,224,224,224,96,96,96,96,224,224,224,224,224,224,224,224]}drawScanline(i,e,t){if(!(t>=224))for(var k=t*256,p=k,F=t>>3<<5,C=t&7,a=0;a<32;a++)for(var u=i[F+a],E=i[2048+(u<<3)+C],m=(u>>5)+(this.palbank<<3),O=this.palette[this.colorprom[m]>>1&7],B=this.palette[this.colorprom[m]>>5&7],n=0;n<8;n++){var L=128>>n;e[p]=E&L?B:O,p++}}};var H=[{id:"minimal.c",name:"Minimal Example"},{id:"hello.c",name:"Hello World"},{id:"gfxtest.c",name:"Graphics Test"},{id:"soundtest.c",name:"Sound Test"},{id:"snake1.c",name:"Siege Game (Prototype)"},{id:"snake2.c",name:"Siege Game (Full)"},{id:"music.c",name:"Music Player"}],x=class extends M{constructor(){super(...arguments);this.getMemoryMap=function(){return{main:[{name:"Cell RAM",start:57344,size:1024,type:"ram"},{name:"Tile RAM",start:59392,size:256*8,type:"ram"}]}}}newMachine(){return new r}getPresets(){return H}getDefaultExtension(){return".c"}readAddress(e){return this.machine.read(e)}showHelp(){return"https://8bitworkshop.com/docs/platforms/arcade/index.html#vic-dual"}};h.vicdual=x;
//# sourceMappingURL=vicdual-AHZIXKAB.js.map

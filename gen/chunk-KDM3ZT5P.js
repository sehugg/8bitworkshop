import{c as A,g as s}from"./chunk-QWAF5HSH.js";var C=!1,P=[[{N:0},{N:1}],[{N:1},{N:0}],[{V:0},{V:1}],[{V:1},{V:0}],[{C:0},{C:1}],[{C:1},{C:0}],[{Z:0},{Z:1}],[{Z:1},{Z:0}]];function L(l,e){if(l==null||e==null)return null;for(var t in l)if(e[t]!=="undefined")return l[t]==e[t];for(var t in e)if(l[t]!=="undefined")return l[t]==e[t];return null}var m=class{constructor(e){this.pc2clockrange={};this.jsrresult={};this.MAX_CYCLES=2e3;this.platform=e}getClockCountsAtPC(e){var t=this.platform.readAddress(e),r=this.platform.getOpcodeMetadata(t,e);return r}traceInstructions(e,t,r,i,u){C&&console.log("trace",s(e),t,r),u||(u={});var f=!0,S=!1;for(let d=0;f&&!S;d++){if(d>=this.MAX_CYCLES){console.log("too many cycles @",s(e),"routine",s(i));break}f=!1,this.WRAP_CLOCKS?(t=t%this.MAX_CLOCKS,r=r%this.MAX_CLOCKS,r==t-1&&(C&&console.log("0-75",s(e),t,r),t=0,r=this.MAX_CLOCKS-1)):(t=Math.min(this.MAX_CLOCKS,t),r=Math.min(this.MAX_CLOCKS,r));let a=this.getClockCountsAtPC(e),g=this.platform.readAddress(e+1),M=this.platform.readAddress(e+2),x=g+(M<<8),c=e,o=this.pc2clockrange[c];if(o==null&&(this.pc2clockrange[c]=o={minclocks:t,maxclocks:r},C&&console.log("new",s(e),s(c),s(i),t,r),f=!0),(o.minclocks!=t||o.maxclocks!=r)&&(this.WRAP_CLOCKS&&t<=r!=o.minclocks<=o.maxclocks&&(C&&console.log("wrap",s(e),s(c),s(i),t,r,o),o.minclocks=t=0,o.maxclocks=r=this.MAX_CLOCKS-1,f=!0),t<o.minclocks&&(C&&console.log("min",s(e),s(c),s(i),t,r,o),o.minclocks=t,f=!0),r>o.maxclocks&&(C&&console.log("max",s(e),s(c),s(i),t,r,o),o.maxclocks=r,f=!0)),!a.insnlength){console.log("Illegal instruction!",s(e),s(a.opcode),a);break}e+=a.insnlength;var b=u;u=null;let O=this.getMaxCyclesForSync(a,g,M);if(typeof O=="number")t=0,r=O,a.minCycles=a.maxCycles=0;else switch(a.opcode){case 25:case 29:case 57:case 61:case 89:case 93:case 121:case 125:case 185:case 187:case 188:case 189:case 190:case 191:case 217:case 221:case 249:case 253:g==0&&(a.maxCycles-=1);break;case 32:t+=a.minCycles,r+=a.maxCycles,this.traceInstructions(x,t,r,x,u);var n=this.jsrresult[x];n?(t=n.minclocks,r=n.maxclocks):(console.log("No JSR result!",s(e),s(x)),t=r);break;case 76:e=x;break;case 64:S=!0;break;case 96:if(i){var n=this.jsrresult[i];n?n={minclocks:Math.min(t,n.minclocks),maxclocks:Math.max(r,n.maxclocks)}:n={minclocks:t,maxclocks:r},this.jsrresult[i]=n,console.log("RTS",s(e),s(i),this.jsrresult[i])}return;case 16:case 48:case 80:case 112:case 144:case 176:case 208:case 240:var y=e+A(g),p=e>>8!=y>>8;p||a.maxCycles--;var h=P[Math.floor((a.opcode-16)/32)],T=L(b,h[0]),R=L(b,h[1]);this.traceInstructions(y,t+a.maxCycles,r+a.maxCycles,i,h[0]),R===!1&&(console.log("branch always taken",s(e),b,h[1]),S=!0),u=h[1],a.maxCycles=a.minCycles;break;case 108:console.log("Instruction not supported!",s(e),s(a.opcode),a);return}C&&console.log("add",s(e),a.minCycles,a.maxCycles),t+=a.minCycles,r+=a.maxCycles}}showLoopTimingForPC(e){this.pc2clockrange={},this.jsrresult={},this.traceInstructions(e|this.platform.getOriginPC(),this.START_CLOCKS,this.MAX_CLOCKS,0,{})}getMaxCyclesForSync(e,t,r){}},K=class extends m{constructor(e){super(e),this.MAX_CLOCKS=76,this.START_CLOCKS=0,this.WRAP_CLOCKS=!0}getMaxCyclesForSync(e,t,r){if(e.opcode==133&&t==2)return 0}},_=class extends m{constructor(e){super(e),this.MAX_CLOCKS=114,this.START_CLOCKS=0,this.WRAP_CLOCKS=!0}getMaxCyclesForSync(e,t,r){if(e.opcode==44&&t==2&&r==32)return 4}};export{K as a,_ as b};
//# sourceMappingURL=chunk-KDM3ZT5P.js.map

{
  "version": 3,
  "sources": ["../src/machine/astrocade.ts", "../src/platform/astrocade.ts"],
  "sourcesContent": ["\nimport { Z80, Z80State } from \"../common/cpu/ZilogZ80\";\nimport { BasicScanlineMachine, AcceptsPaddleInput, Bus } from \"../common/devices\";\nimport { KeyFlags, newAddressDecoder, padBytes, Keys, makeKeycodeMap, newKeyboardHandler } from \"../common/emu\";\nimport { TssChannelAdapter, MasterAudio, AY38910_Audio } from \"../common/audio\";\nimport { hex, rgb2bgr, lzgmini, stringToByteArray } from \"../common/util\";\n\n// http://metopal.com/projects/ballybook/doku.php\n\n// TODO: fix keys, more controllers, vibrato/noise, border color\n// http://atariage.com/forums/topic/251416-programming-the-bally-arcadeastrocade/\n// https://ballyalley.com/faqs/BPA%20Video%20Hardware%20FAQ/Bally_Professional_Arcade_Video_Hardware%20(2001)(Tony%20Miller).pdf\n// https://atariage.com/forums/topic/290858-notes-from-a-2019-interview-with-jamie-fenton/ (http://www.fentonia.com/bio/)\n// https://thehistoryofhowweplay.wordpress.com/2018/04/03/interview-tom-mchugh/\n// https://ballyalley.com/faqs/Programmers%20of%20the%20Astrocade%20Built-In%20Programs.txt\n\nconst ASTROCADE_KEYCODE_MAP = makeKeycodeMap([\n  // player 1\n  [Keys.UP, 0x10, 0x1],\n  [Keys.DOWN, 0x10, 0x2],\n  [Keys.LEFT, 0x10, 0x4],\n  [Keys.RIGHT, 0x10, 0x8],\n  [Keys.A, 0x10, 0x10],\n  // player 2\n  [Keys.P2_UP, 0x11, 0x1],\n  [Keys.P2_DOWN, 0x11, 0x2],\n  [Keys.P2_LEFT, 0x11, 0x4],\n  [Keys.P2_RIGHT, 0x11, 0x8],\n  [Keys.P2_A, 0x11, 0x10],\n  // keypad $14\n  [Keys.VK_P, 0x14, 0x1],\n  [Keys.VK_SLASH, 0x14, 0x2],\n  [Keys.VK_X, 0x14, 0x4],\n  [Keys.VK_MINUS, 0x14, 0x8],\n  [Keys.VK_COMMA, 0x14, 0x10],\n  [Keys.VK_EQUALS, 0x14, 0x20],\n  // keypad $15\n  [Keys.VK_O, 0x15, 0x1],\n  [Keys.VK_L, 0x15, 0x2],\n  [Keys.VK_9, 0x15, 0x4],\n  [Keys.VK_6, 0x15, 0x8],\n  [Keys.VK_3, 0x15, 0x10],\n  [Keys.VK_PERIOD, 0x15, 0x20],\n  // keypad $16\n  [Keys.VK_I, 0x16, 0x1],\n  [Keys.VK_K, 0x16, 0x2],\n  [Keys.VK_8, 0x16, 0x4],\n  [Keys.VK_5, 0x16, 0x8],\n  [Keys.VK_2, 0x16, 0x10],\n  [Keys.VK_0, 0x16, 0x20],\n  // keypad $17\n  [Keys.VK_U, 0x17, 0x1],\n  [Keys.VK_J, 0x17, 0x2],\n  [Keys.VK_7, 0x17, 0x4],\n  [Keys.VK_4, 0x17, 0x8],\n  [Keys.VK_1, 0x17, 0x10],\n  [Keys.VK_BACK_SLASH, 0x17, 0x20],\n]);\n\nconst audioOversample = 2;\n\nconst _BallyAstrocade = function(arcade:boolean) {\n\n  var cpu : Z80;\n  var ram : Uint8Array;\n  var membus, iobus : Bus;\n  var rom, bios;\n  var pixels;\n  var psg;\n  //var watchdog_counter;\n  const swidth = arcade ? 320 : 160;\n  const sheight = arcade ? 204 : 102;\n  const swbytes = swidth >> 2;\n  const samask = arcade ? 0x3fff : 0xfff;\n  const INITIAL_WATCHDOG = 256;\n  const PIXEL_ON = 0xffeeeeee;\n  const PIXEL_OFF = 0xff000000;\n\n  // state variables\n  var inputs = new Uint8Array(0x20);\n  var magicop = 0;\n  var xpand = 0;\n  var xplower = false;\n  var shift2 = 0;\n  var horcb = 0;\n  var inmod = 0;\n  var inlin = 0;\n  var infbk = 0;\n  var verbl = sheight;\n  var palette = new Uint32Array(8);\n  var palinds = new Uint8Array(8);\n  var refreshlines = 0;\n  var dirtylines = new Uint8Array(arcade ? 262 : 131);\n  var rotdata = new Uint8Array(4);\n  var rotcount = 0;\n  var intst = 0;\n  var waitstates = 0;\n  var patboard = new Uint8Array(0x08);\n  var patdest = 0;\n\n  function ramwrite(a: number, v: number) {\n    // set RAM\n    ram[a] = v;\n    waitstates++;\n    // mark scanline as dirty\n    dirtylines[((a & samask) / swbytes) | 0] = 1;\n    // this was old behavior where we updated instantly\n    // but it had problems if we had mid-screen palette changes\n    //ramupdate(a, v);\n  }\n\n  function ramupdate(a: number, v: number) {\n    var ofs = a * 4 + 3; // 4 pixels per byte\n    for (var i = 0; i < 4; i++) {\n      var lr = ((a % swbytes) >= (horcb & 0x3f)) ? 0 : 4;\n      pixels[ofs--] = palette[lr + (v & 3)];\n      v >>= 2;\n    }\n  }\n\n  function refreshline(y: number) {\n    var ofs = y * swidth / 4;\n    for (var i = 0; i < swidth / 4; i++)\n      ramupdate(ofs + i, ram[ofs + i]);\n  }\n\n  function magicwrite(a: number, v: number) {\n    // expand\n    if (magicop & 0x8) {\n      var v2 = 0;\n      if (!xplower)\n        v >>= 4;\n      for (var i = 0; i < 4; i++) {\n        var pix = (v & 1) ? ((xpand >> 2) & 3) : (xpand & 3);\n        v2 |= pix << (i * 2);\n        v >>= 1;\n      }\n      v = v2;\n      xplower = !xplower;\n    }\n    // rotate\n    if (magicop & 0x4) {\n      if (rotcount & 4) {\n        // drain buffer\n        var sh = 2 * (~rotcount & 3);\n        v = (((rotdata[3] >> sh) & 3) << 6) |\n          (((rotdata[2] >> sh) & 3) << 4) |\n          (((rotdata[1] >> sh) & 3) << 2) |\n          (((rotdata[0] >> sh) & 3) << 0);\n      } else {\n        // fill buffer\n        rotdata[rotcount & 3] = v;\n      }\n      rotcount++;\n    } else {\n      // shift\n      var sh = (magicop & 3) << 1;\n      var v2 = (v >> sh) | shift2;\n      shift2 = (v << (8 - sh)) & 0xff;\n      v = v2;\n    }\n    // flop\n    if (magicop & 0x40) {\n      v =\n        ((v & 0x03) << 6) |\n        ((v & 0x0c) << 2) |\n        ((v & 0x30) >> 2) |\n        ((v & 0xc0) >> 6);\n    }\n    // or/xor\n    if (magicop & 0x30) {\n      var oldv = ram[a];\n      // collision detect\n      var icpt = 0;\n      if ((oldv & 0xc0) && (v & 0xc0)) icpt |= 0x1;\n      if ((oldv & 0x30) && (v & 0x30)) icpt |= 0x2;\n      if ((oldv & 0x0c) && (v & 0x0c)) icpt |= 0x4;\n      if ((oldv & 0x03) && (v & 0x03)) icpt |= 0x8;\n      // apply op\n      if (magicop & 0x10)\n        v |= oldv;\n      if (magicop & 0x20)\n        v ^= oldv; // TODO: what if both?\n      // upper 4 bits persist, lower are just since last write\n      intst = (intst & 0xf0) | icpt | (icpt << 4);\n    }\n    // commit write to ram/screen\n    ramwrite(a, v);\n  }\n\n  function setpalette(a: number, v: number) {\n    palinds[a & 7] = v & 0xff;\n    palette[a & 7] = ASTROCADE_PALETTE[v & 0xff];\n    refreshall();\n  }\n\n  function setbordercolor() {\n    var col = horcb >> 6;\n    // TODO\n  }\n\n  function refreshall() {\n    refreshlines = sheight;\n  }\n\n  // bally astrocade pattern board\n  // https://github.com/mamedev/mame/blob/7ff10685c56a6e123336c684e5e96fdb9e8b3674/src/mame/midway/astrocde_v.cpp#L726\n  function xfer_patboard() {\n    let m_pattern_source = patboard[0] | (patboard[1] << 8);\n    let m_pattern_mode = patboard[2] & 0x3f;\n    let m_pattern_skip = patboard[3];\n    let m_pattern_dest = (patdest & 0xff) | (patboard[4] << 8);\n    let m_pattern_width = patboard[5];\n    let m_pattern_height = patboard[6] + 1;\n\n    let curwidth: number;\n    let u13ff: number = 0;\n    let cycles: number = 0;\n\n    u13ff = 0;\n\n    if ((m_pattern_mode & 0x02) === 0) {\n      u13ff = 1;\n    }\n\n    function incrementSource(): void {\n      if (u13ff && (m_pattern_mode & 0x04) !== 0 && (curwidth !== 0 || (m_pattern_mode & 0x08) === 0)) {\n        m_pattern_source++;\n      }\n\n      if ((m_pattern_mode & 0x02) !== 0) {\n        u13ff ^= 1;\n      }\n    }\n\n    function incrementDest(): void {\n      if (curwidth !== 0) {\n        if ((m_pattern_mode & 0x20) !== 0) {\n          m_pattern_dest++;\n        } else {\n          m_pattern_dest--;\n        }\n      }\n    }\n\n    // Loop over height\n    while (m_pattern_height >= 0) {\n      let carry: number;\n\n      curwidth = m_pattern_width;\n\n      // Loop over width\n      while (curwidth >= 0) {\n        let busaddr: number;\n        let busdata: number;\n\n        // Read Phase\n        busaddr = (m_pattern_mode & 0x01) === 0 ? m_pattern_source : m_pattern_dest;\n\n        if (curwidth === 0 && (m_pattern_mode & 0x08) !== 0) {\n          busdata = 0;\n        } else {\n          busdata = membus.read(m_pattern_source);\n        }\n\n        if ((m_pattern_mode & 0x01) === 0) {\n          incrementSource();\n        } else {\n          incrementDest();\n        }\n\n        // Write Phase\n        busaddr = (m_pattern_mode & 0x01) !== 0 ? m_pattern_source : m_pattern_dest;\n        ramwrite(busaddr, busdata);\n\n        if ((m_pattern_mode & 0x01) === 0) {\n          incrementDest();\n        } else {\n          incrementSource();\n        }\n\n        cycles += 4;\n        curwidth--;\n      }\n\n      // At the end of each row, adjust m_pattern_dest\n      carry = ((m_pattern_dest & 0xff) + m_pattern_skip) & 0x100;\n      m_pattern_dest = (m_pattern_dest & 0xff00) | ((m_pattern_dest + m_pattern_skip) & 0xff);\n\n      if ((m_pattern_mode & 0x10) === 0) {\n        m_pattern_dest += carry;\n      } else {\n        m_pattern_dest -= carry ^ 0x100;\n      }\n\n      m_pattern_height--;\n    }\n\n    // Adjust m_maincpu.icount\n    // m_maincpu.adjust_icount(-cycles);\n    // Replace the above line with the actual adjustment of icount.\n  }\n    \n  this.drawScanline = (sl:number) => {\n    // interrupt\n    if (sl == inlin && (inmod & 0x8)) {\n      cpu.retryInterrupts = !(inmod & 0x4);\n      this.probe && this.probe.logInterrupt(infbk);\n      cpu.interrupt(infbk);\n    }\n    // refresh this line in frame buffer?\n    if (sl < sheight && refreshlines > 0) {\n      dirtylines[sl] = 0;\n      refreshline(sl);\n      refreshlines--;\n    }\n    else if (dirtylines[sl]) {\n      dirtylines[sl] = 0;\n      refreshline(sl);\n    }\n  }\n  \n  this.init = (machine:BallyAstrocade, c:Z80, r:Uint8Array, inp:Uint8Array<ArrayBuffer>, psgg) => {\n    cpu = c;\n    ram = r;\n    inputs = inp;\n    psg = psgg;\n    if (!arcade) {\n      //bios = padBytes(ASTROCADE_MINIMAL_BIOS, 0x2000);\n      bios = padBytes(new lzgmini().decode(stringToByteArray(atob(ASTROLIBRE_BIOS_LZG))), 0x2000);\n      // game console\n      membus = {\n        read: newAddressDecoder([\n          [0x0000, 0x1fff, 0x1fff, function(a) { return bios[a]; }],\n          [0x2000, 0x3fff, 0x1fff, function(a) { return rom ? rom[a] : 0; }],\n          [0x4000, 0x4fff, 0xfff, function(a) { waitstates++; return ram[a]; }],\n        ]),\n        write: newAddressDecoder([\n          [0x4000, 0x4fff, 0xfff, ramwrite],\n          [0x0000, 0x3fff, 0xfff, magicwrite],\n        ]),\n      }\n    } else {\n      // arcade game (TODO: wait states 1/4 of the time)\n      membus = {\n        read: newAddressDecoder([\n          [0x4000, 0x7fff, 0x3fff, function(a) { return ram[a]; }],\t// screen RAM\n          [0xd000, 0xdfff, 0x0fff, function(a) { return ram[a + 0x4000]; }], // static RAM\n          [0x0000, 0x3fff, 0x3fff, function(a) { return rom ? rom[a] : 0; }], // ROM\n          [0x8000, 0xbfff, 0x3fff, function(a) { return rom ? rom[a + 0x4000] : 0; }], // ROM\n        ]),\n        write: newAddressDecoder([\n          [0x4000, 0x7fff, 0x3fff, ramwrite],\n          [0x0000, 0x3fff, 0x3fff, magicwrite],\n          [0xd000, 0xdfff, 0x0fff, function(a, v) { ramwrite(a + 0x4000, v); }], // static RAM\n        ]),\n      }\n    }\n    iobus = {\n      read: function(addr) {\n        addr &= 0x1f;\n        var rtn;\n        switch (addr) {\n          case 8:\n            rtn = intst;\n            intst = 0;\n            break;\n          default:\n            rtn = inputs[addr];\n            break;\n          // $10 = watchdog\n        }\n        return rtn;\n      },\n      write: function(addr, val) {\n        if (addr == 0xa55b) {\n          // TODO: protected_ram_enable_w\n          return;\n        }\n        addr &= 0xff;\n        // pattern board\n        if (addr > 0x78 && addr < 0x80) {\n          patboard[addr & 7] = val;\n          if (addr == 0x72) { patdest = 0; }\n          if (addr == 0x74) { patdest = (patdest + patboard[3]) & 0xff; }\n          if (addr == 0x7e) { xfer_patboard(); }\n          return;\n        }\n        addr &= 0x1f;\n        val &= 0xff;\n        switch (addr) {\n          case 0:\n          case 1:\n          case 2:\n          case 3:\n          case 4:\n          case 5:\n          case 6:\n          case 7:\n            setpalette(addr, val);\n            break;\n          case 9:   // HORCB (horizontal boundary byte)\n            horcb = val;\n            setbordercolor();\n            refreshall();\n            break;\n          case 0xa: // VERBL (vertical blank)\n            verbl = arcade ? val : val >> 1;\n            refreshall();\n            break;\n          case 0xb: // OTIR (set palette)\n            var c = cpu.saveState();\n            //console.log(c.BC>>8, c.HL);\n            setpalette((c.BC >> 8) - 1, membus.read(c.HL));\n            break;\n          case 0xc: // magic register\n            magicop = val;\n            shift2 = 0;\n            rotcount = 0;\n            xplower = false;\n            break;\n          case 0xd: // INFBK (interrupt feedback)\n            infbk = val;\n            break;\n          case 0xe: // INMOD (interrupt enable)\n            inmod = val;\n            break;\n          case 0xf: // INLIN (interrupt line)\n            inlin = arcade ? val : val >> 1;\n            break;\n          case 0x10:\n          case 0x11:\n          case 0x12:\n          case 0x13:\n          case 0x14:\n          case 0x15:\n          case 0x16:\n          case 0x17:\n            psg.setACRegister(addr, val);\n            break;\n          case 0x18:\n            var c = cpu.saveState();\n            psg.setACRegister((c.BC >> 8) - 1, membus.read(c.HL));\n            break;\n          case 0x19: // XPAND\n            xpand = val;\t\n            break;\n          case 0x1a:\n          case 0x1b:\n          case 0x1c:\n          case 0x1d:\n          case 0x1e:\n            //psg2.setACRegister(addr - 0x1a, val);\n            break;\n          default:\n            //console.log('IO write', hex(addr, 4), hex(val, 2));\n            break;\n        }\n      }\n    }\n    machine.connectCPUMemoryBus(membus);\n    machine.connectCPUIOBus(iobus);\n    this.membus = membus;\n    this.iobus = iobus;\n    // default palette\n    for (var i = 0; i < 8; i++) {\n      setpalette(i,i);\n    }\n  };\n\n  this.resetWaitStates = function(sl) {\n    var n = sl < verbl ? waitstates : 0; // only wait if video active\n    waitstates = 0;\n    return n;\n  }\n\n  this.loadState = (state) => {\n    cpu.loadState(state.c);\n    ram.set(state.ram);\n    palette.set(state.palette);\n    palinds.set(state.palinds);\n    magicop = state.magicop;\n    xpand = state.xpand;\n    xplower = state.xplower;\n    shift2 = state.shift2;\n    horcb = state.horcb;\n    inmod = state.inmod;\n    inlin = state.inlin;\n    infbk = state.infbk;\n    verbl = state.verbl;\n    rotcount = state.rotcount;\n    rotdata.set(state.rotdata);\n    intst = state.intst;\n    inputs.set(state.inputs);\n    patboard.set(state.patboard);\n    patdest = state.patdest;\n    refreshall();\n  }\n    \n  this.saveState = () => {\n    return {\n      c: cpu.saveState(),\n      ram: ram.slice(0),\n      inputs: inputs.slice(0),\n      palette: palette.slice(0),\n      palinds: palinds.slice(0),\n      magicop: magicop,\n      xpand: xpand,\n      xplower: xplower,\n      shift2: shift2,\n      horcb: horcb,\n      inmod: inmod,\n      inlin: inlin,\n      infbk: infbk,\n      verbl: verbl,\n      rotcount: rotcount,\n      rotdata: rotdata.slice(0),\n      intst: intst,\n      patboard: patboard.slice(0),\n      patdest: patdest,\n    };\n  }\n  this.reset = () => {\n    // TODO?\n    magicop = xpand = inmod = inlin = infbk = shift2 = horcb = 0;\n    verbl = sheight;\n    xplower = false;\n    //watchdog_counter = INITIAL_WATCHDOG;\n  }\n  \n  this.toLongString = (st) =>  {\n    var s = \"\";\n    //s += \" Scan Y: \" + st.sl;\n    s += \"\\n  INLIN: \" + st.inlin;\n    s += \"\\n  VERBL: \" + st.verbl;\n    s += \"\\nMAGICOP: $\" + hex(st.magicop);\n    s += \"\\n  XPAND: $\" + hex(st.xpand);\n    s += \"\\nXPLOWER: \" + st.xplower;\n    s += \"\\n SHIFT2: $\" + hex(st.shift2);\n    s += \"\\n  HORCB: $\" + hex(st.horcb);\n    s += \"\\n  INMOD: $\" + hex(st.inmod);\n    s += \"\\n  INFBK: $\" + hex(st.infbk);\n    s += \"\\n  INTST: $\" + hex(st.intst); // intercept status\n    s += \"\\nPalette: \";\n    for (var i = 0; i < 8; i++)\n      s += hex(palinds[i]);\n    s += \"\\n\";\n    return s;\n  }\n  \n  this.connectVideo = function(pix) {\n    pixels = pix;\n  }\n  this.loadROM = function(data) {\n    rom = data;\n  }\n  this.loadBIOS = function(data) {\n    bios = data;\n  }\n  this.getVisiblePixelWords = function() {\n    return verbl * swidth;\n  }\n}\n\nexport class BallyAstrocade extends BasicScanlineMachine implements AcceptsPaddleInput {\n  \n  cpuFrequency = 1789000;\n  numTotalScanlines = 262;\n  numVisibleScanlines : number;\n  cpuCyclesPerLine : number;\n  defaultROMSize : number;\n  canvasWidth : number;\n  sampleRate = 60 * 262 * audioOversample;\n  ram : Uint8Array;\n  cpu : Z80;\n  m; // _BallyAstrocade\n  arcade : boolean;\n\n  psg: AstrocadeAudio;\n  audioadapter;\n  backbuffer : Uint32Array;\n  frontbuffer : Uint32Array;\n\n  constructor(arcade:boolean) {\n    super();\n    this.arcade = arcade;\n    this.cpu = new Z80();\n    this.psg = new AstrocadeAudio(new MasterAudio());\n    this.audioadapter = new TssChannelAdapter(this.psg.psg, audioOversample, this.sampleRate);\n    this.handler = newKeyboardHandler(this.inputs, ASTROCADE_KEYCODE_MAP);\n    this.defaultROMSize = arcade ? 0xb000 : 0x2000;\n    this.ram = new Uint8Array(arcade ? 0x5000 : 0x1000);\n    this.numVisibleScanlines = arcade ? 204 : 102;\n    this.canvasWidth = arcade ? 320 : 160;\n    this.cpuCyclesPerLine = (this.cpuFrequency / (60 * this.numVisibleScanlines * 1.286)) | 0;\n    //this.cpuCyclesPerHBlank = Math.floor(this.cpuCyclesPerLine * 0.33);\n    //this.cpuCyclesPerVisible = this.cpuCyclesPerLine - this.cpuCyclesPerHBlank;\n    this.m = new _BallyAstrocade(arcade);\n    this.m.init(this, this.cpu, this.ram, this.inputs, this.psg);\n    if (arcade) {\n      this.inputs[0x10] = 0xff; // switches (active low)\n      this.inputs[0x11] = 0xff; // switches (active low)\n      this.inputs[0x12] = 0x00;\n      this.inputs[0x13] = 0x08; // dip switches\n    }\n  }\n  \n  read(a:number) : number {\n    return this.m.membus.read(a);\n  }\n  write(a:number, v:number) : void {\n    this.m.membus.write(a,v);\n  }\n  \n  connectVideo(pixels:Uint32Array) : void {\n    super.connectVideo(pixels);\n    this.frontbuffer = pixels;\n    this.backbuffer = new Uint32Array(pixels.length);\n    this.m.connectVideo(this.backbuffer);\n  }\n  preFrame() {\n    this.m.resetWaitStates(0);\n  }\n  postFrame() {\n    // copy back buffer to front buffer, omitting bottom non-visible pixels\n    var nbytes = this.m.getVisiblePixelWords();\n    this.frontbuffer.set(this.backbuffer.slice(0, nbytes), 0);\n    this.frontbuffer.fill(0, nbytes);\n  }\n\n  setPaddleInput(controller:number, value:number) : void {\n    switch (controller) {\n      case 0: this.inputs[0x1c] = value & 0xff; break;\n      case 1: this.inputs[0x1d] = value & 0xff; break;\n    }\n  }\n\n  startScanline() {\n    this.audio && this.audioadapter.generate(this.audio);\n  }\n  \n  drawScanline() {\n    var sl = this.scanline;\n    this.m.drawScanline(sl);\n    /*\n    if (watchdog_counter-- <= 0) {\n      console.log(\"WATCHDOG FIRED\"); // TODO: alert on video\n      this.reset();\n    }\n    */\n  }\n\n  advanceCPU() {\n    var clk = super.advanceCPU();\n    // TODO: disable 33% of the time (hblank)\n    var xtra = this.m.resetWaitStates(this.scanline);\n    if (xtra) {\n      clk += xtra;\n      this.probe.logClocks(xtra);\n    }\n    return clk;\n  }\n\n  loadROM(data) {\n    super.loadROM(data);\n    this.m.loadROM(this.rom);\n    this.reset();\n  }\n  loadBIOS(data) {\n    this.m.loadBIOS(padBytes(data, 0x2000));\n    this.reset();\n  }\n  reset() {\n    super.reset();\n    this.m.reset();\n  }\n  loadState(state) {\n    this.m.loadState(state);\n  }\n  saveState() {\n    return this.m.saveState();\n  }\n  getDebugCategories() {\n    return ['CPU','Stack','Astro'];\n  }\n  getDebugInfo(category, state) {\n    switch (category) {\n      case 'Astro': return this.m.toLongString(state);\n    }\n  }\n  getRasterCanvasPosition() {\n    return { x: this.getRasterX(), y: this.getRasterY() };\n  }\n  getVideoParams() {\n    if (this.arcade) {\n      return { width: 320, height: 204, rotate: 180 };\n    } else {\n      return { width: 160, height: 102 };\n    }\n  }\n}\n\n/////\n\n// TODO: https://github.com/mamedev/mame/blob/master/src/devices/sound/astrocde.cpp\nclass AstrocadeAudio extends AY38910_Audio {\n  setACRegister(addr: number, val: number) {\n    addr &= 0x7;\n    val &= 0xff;\n    switch (addr) {\n      case 0:\n        this.psg.setClock(1789000 * 16 / (val + 1));\n        this.psg.writeRegisterAY(7, 0x7 ^ 0xff); // disable noise\n        break;\n      case 1:\n      case 2:\n      case 3:\n        var i = (addr - 1) * 2;\n        var j = val * 2 + 1;\n        this.psg.writeRegisterAY(i, j & 0xff); // freq lo\n        this.psg.writeRegisterAY(i + 1, (j >> 8) & 0xff); // freq hi\n        break;\n      case 5:\n        this.psg.writeRegisterAY(10, val & 0xf); // tone c vol\n        break;\n      case 6:\n        this.psg.writeRegisterAY(8, val & 0xf);\t// tone a vol\n        this.psg.writeRegisterAY(9, (val >> 4) & 0xf); // tone b vol\n        break;\n    }\n  }\n}\n\n/////\n\n//http://glankonian.com/~lance/astrocade_palette.html\nvar ASTROCADE_PALETTE = [0x000000, 0x242424, 0x484848, 0x6D6D6D, 0x919191, 0xB6B6B6, 0xDADADA, 0xFFFFFF, 0x2500BB, 0x4900E0, 0x6E11FF, 0x9235FF, 0xB75AFF, 0xDB7EFF, 0xFFA3FF, 0xFFC7FF, 0x4900B0, 0x6D00D5, 0x9201F9, 0xB625FF, 0xDA4AFF, 0xFF6EFF, 0xFF92FF, 0xFFB7FF, 0x6A009F, 0x8E00C3, 0xB300E7, 0xD718FF, 0xFB3CFF, 0xFF61FF, 0xFF85FF, 0xFFA9FF, 0x870087, 0xAB00AB, 0xD000D0, 0xF40EF4, 0xFF32FF, 0xFF56FF, 0xFF7BFF, 0xFF9FFF, 0x9F006A, 0xC3008E, 0xE700B3, 0xFF07D7, 0xFF2CFB, 0xFF50FF, 0xFF74FF, 0xFF99FF, 0xB00049, 0xD5006D, 0xF90092, 0xFF05B6, 0xFF29DA, 0xFF4DFF, 0xFF72FF, 0xFF96FF, 0xBB0025, 0xE00049, 0xFF006E, 0xFF0692, 0xFF2AB7, 0xFF4FDB, 0xFF73FF, 0xFF98FF, 0xBF0000, 0xE30024, 0xFF0048, 0xFF0B6D, 0xFF3091, 0xFF54B6, 0xFF79DA, 0xFF9DFF, 0xBB0000, 0xE00000, 0xFF0023, 0xFF1447, 0xFF396C, 0xFF5D90, 0xFF82B5, 0xFFA6D9, 0xB00000, 0xD50000, 0xF90000, 0xFF2124, 0xFF4548, 0xFF6A6C, 0xFF8E91, 0xFFB3B5, 0x9F0000, 0xC30000, 0xE70C00, 0xFF3003, 0xFF5527, 0xFF794B, 0xFF9E70, 0xFFC294, 0x870000, 0xAB0000, 0xD01E00, 0xF44200, 0xFF670A, 0xFF8B2E, 0xFFAF53, 0xFFD477, 0x6A0000, 0x8E0D00, 0xB33100, 0xD75600, 0xFB7A00, 0xFF9E17, 0xFFC33B, 0xFFE75F, 0x490000, 0x6D2100, 0x924500, 0xB66A00, 0xDA8E00, 0xFFB305, 0xFFD729, 0xFFFC4E, 0x251100, 0x493500, 0x6E5A00, 0x927E00, 0xB7A300, 0xDBC700, 0xFFEB1E, 0xFFFF43, 0x002500, 0x244900, 0x486D00, 0x6D9200, 0x91B600, 0xB6DB00, 0xDAFF1B, 0xFFFF3F, 0x003700, 0x005B00, 0x238000, 0x47A400, 0x6CC900, 0x90ED00, 0xB5FF1E, 0xD9FF43, 0x004700, 0x006C00, 0x009000, 0x24B400, 0x48D900, 0x6CFD05, 0x91FF29, 0xB5FF4E, 0x005500, 0x007900, 0x009D00, 0x03C200, 0x27E600, 0x4BFF17, 0x70FF3B, 0x94FF5F, 0x005F00, 0x008300, 0x00A800, 0x00CC00, 0x0AF00A, 0x2EFF2E, 0x53FF53, 0x77FF77, 0x006500, 0x008A00, 0x00AE00, 0x00D203, 0x00F727, 0x17FF4B, 0x3BFF70, 0x5FFF94, 0x006800, 0x008C00, 0x00B100, 0x00D524, 0x00F948, 0x05FF6C, 0x29FF91, 0x4EFFB5, 0x006600, 0x008B00, 0x00AF23, 0x00D447, 0x00F86C, 0x00FF90, 0x1EFFB5, 0x43FFD9, 0x006100, 0x008524, 0x00AA48, 0x00CE6D, 0x00F391, 0x00FFB6, 0x1BFFDA, 0x3FFFFE, 0x005825, 0x007C49, 0x00A16E, 0x00C592, 0x00EAB7, 0x00FFDB, 0x1EFFFF, 0x43FFFF, 0x004B49, 0x00706D, 0x009492, 0x00B9B6, 0x00DDDA, 0x05FFFF, 0x29FFFF, 0x4EFFFF, 0x003C6A, 0x00608E, 0x0085B3, 0x00A9D7, 0x00CEFB, 0x17F2FF, 0x3BFFFF, 0x5FFFFF, 0x002A87, 0x004FAB, 0x0073D0, 0x0097F4, 0x0ABCFF, 0x2EE0FF, 0x53FFFF, 0x77FFFF, 0x00179F, 0x003BC3, 0x0060E7, 0x0384FF, 0x27A8FF, 0x4BCDFF, 0x70F1FF, 0x94FFFF, 0x0002B0, 0x0027D5, 0x004BF9, 0x2470FF, 0x4894FF, 0x6CB9FF, 0x91DDFF, 0xB5FFFF, 0x0000BB, 0x0013E0, 0x2337FF, 0x475BFF, 0x6C80FF, 0x90A4FF, 0xB5C9FF, 0xD9EDFF];\n// swap palette RGB to BGR\nfor (var i = 0; i < 256; i++) {\n  var x = ASTROCADE_PALETTE[i];\n  ASTROCADE_PALETTE[i] = rgb2bgr(x) | 0xff000000;\n}\n\n/*\n0000 F3            [ 4]  196 \tDI\t; disable interrupts\n0001 21 00 20      [10]  197 \tLD\tHL,#0x2000\n0004 7E            [ 7]  198 \tLD\tA,(HL) ; A <- mem[0x2000]\n0005 FE 55         [ 7]  199 \tCP\t#0x55 ; found sentinel byte? ($55)\n0007 CA 0D 00      [10]  200 \tJP\tZ,FoundSentinel ; yes, load program\n000A C3 00 20      [10]  201 \tJP\t_main ; jump to test program\n000D                     202 \tFoundSentinel:\n000D 31 CE 4F      [10]  203 \tLD\tSP,#0x4fce ; position stack below BIOS vars\n0010 CD 84 02      [17]  204 \tCALL\t_bios_init ; misc. bios init routines\n0013 21 05 20      [10]  205 \tLD\tHL,#0x2005 ; cartridge start vector\n0016 7E            [ 7]  206 \tLD\tA,(HL)\n0017 23            [ 6]  207 \tINC\tHL\n0018 66            [ 7]  208 \tLD\tH,(HL)\n0019 6F            [ 4]  209 \tLD\tL,A\n001A E9            [ 4]  210 \tJP\t(HL) ; jump to cart start vector\n*/\nvar ASTROCADE_MINIMAL_BIOS = [\n  0xf3, 0x21, 0x00, 0x20, 0x7e, 0xfe, 0x55, 0xca, 0x0d, 0x00, 0xc3, 0x00, 0x20,\n  0x31, 0xce, 0x4f,\n  0x21, 0x05, 0x20, 0x7e, 0x23, 0x66, 0x6f,\n  0xe9,\n];\n\nvar ASTROLIBRE_BIOS_LZG = `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`;\n\n", "\nimport { BallyAstrocade } from \"../machine/astrocade\";\nimport { BaseZ80MachinePlatform } from \"../common/baseplatform\";\nimport { Platform } from \"../common/baseplatform\";\nimport { PLATFORMS } from \"../common/emu\";\n\n// http://metopal.com/projects/ballybook/doku.php\n\nconst ASTROCADE_PRESETS = [\n  { id: '01-helloworlds.asm', name: 'Hello World (ASM)' },\n  { id: '02-telephone.asm', name: 'Telephone (ASM)' },\n  { id: '03-horcbpal.asm', name: 'Paddle Demo (ASM)' },\n  { id: 'hello.c', name: 'Hello Graphics' },\n  { id: 'lines.c', name: 'Lines' },\n  { id: 'sprites.c', name: 'Sprites' },\n  { id: 'vsync.c', name: 'Sprites w/ VSYNC' },\n  { id: 'fastsprites.c', name: 'Fast Sprites' },\n  { id: 'music.c', name: 'Music' },\n  { id: 'rotate.c', name: 'Rotate Op' },\n  { id: 'rainbow.c', name: 'Rainbow' },\n  { id: 'cosmic.c', name: 'Cosmic Impalas Game' },\n  { id: 'racing.c', name: 'Pseudo 3-D Racing Game' },\n];\n\nconst ASTROCADE_BIOS_PRESETS = [\n  { id: 'bios.c', name: 'BIOS' },\n];\n\nconst ASTROCADE_ARCADE_PRESETS = [\n  { id: 'hello.c', name: 'Hello Graphics' },\n];\n\nclass BallyAstrocadePlatform extends BaseZ80MachinePlatform<BallyAstrocade> implements Platform {\n\n  newMachine()          { return new BallyAstrocade(false); }\n  getPresets()          { return ASTROCADE_PRESETS; }\n  getDefaultExtension() { return \".c\"; };\n  readAddress(a)        { return this.machine.read(a); }\n  getMemoryMap = function() { return { main:[\n      {name:'BIOS',start:0x0,size:0x2000,type:'rom'},\n      //{name:'Cart ROM',start:0x2000,size:0x2000,type:'rom'},\n      //{name:'Magic RAM',start:0x0,size:0x4000,type:'ram'},\n      {name:'Screen RAM',start:0x4000,size:0x1000,type:'ram'},\n      {name:'BIOS Variables',start:0x4fce,size:0x5000-0x4fce,type:'ram'},\n  ] } };\n  showHelp() { return \"https://8bitworkshop.com/docs/platforms/astrocade/\"; }\n}\n\nclass BallyAstrocadeBIOSPlatform extends BallyAstrocadePlatform implements Platform {\n\n  getPresets()          { return ASTROCADE_BIOS_PRESETS; }\n  loadROM(title,rom)    { this.machine.loadBIOS(rom); }\n\n}\n\nclass BallyArcadePlatform extends BallyAstrocadePlatform implements Platform {\n\n  newMachine()          { return new BallyAstrocade(true); }\n  getPresets()          { return ASTROCADE_ARCADE_PRESETS; }\n\n  getMemoryMap = function() { return { main:[\n      {name:'ROM',start:0x0,size:0x4000,type:'rom'},\n      {name:'Magic RAM',start:0x0,size:0x4000,type:'ram'},\n      {name:'Screen RAM',start:0x4000,size:0x4000,type:'ram'},\n      {name:'ROM',start:0x8000,size:0x4000,type:'rom'},\n  ] } };\n}\n\nPLATFORMS['astrocade'] = BallyAstrocadePlatform;\nPLATFORMS['astrocade-bios'] = BallyAstrocadeBIOSPlatform;\nPLATFORMS['astrocade-arcade'] = BallyArcadePlatform;\n\n"],
  "mappings": "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",
  "names": ["ASTROCADE_KEYCODE_MAP", "makeKeycodeMap", "Keys", "audioOversample", "_BallyAstrocade", "arcade", "cpu", "ram", "membus", "iobus", "rom", "bios", "pixels", "psg", "swidth", "sheight", "swbytes", "samask", "INITIAL_WATCHDOG", "PIXEL_ON", "PIXEL_OFF", "inputs", "magicop", "xpand", "xplower", "shift2", "horcb", "inmod", "inlin", "infbk", "verbl", "palette", "palinds", "refreshlines", "dirtylines", "rotdata", "rotcount", "intst", "waitstates", "patboard", "patdest", "ramwrite", "a", "v", "ramupdate", "ofs", "i", "lr", "refreshline", "y", "magicwrite", "v2", "pix", "sh", "oldv", "icpt", "setpalette", "ASTROCADE_PALETTE", "refreshall", "setbordercolor", "col", "xfer_patboard", "m_pattern_source", "m_pattern_mode", "m_pattern_skip", "m_pattern_dest", "m_pattern_width", "m_pattern_height", "curwidth", "u13ff", "cycles", "incrementSource", "incrementDest", "carry", "busaddr", "busdata", "sl", "machine", "c", "r", "inp", "psgg", "newAddressDecoder", "padBytes", "lzgmini", "stringToByteArray", "ASTROLIBRE_BIOS_LZG", "addr", "rtn", "val", "n", "state", "st", "s", "hex", "data", "BallyAstrocade", "BasicScanlineMachine", "Z80", "AstrocadeAudio", "MasterAudio", "TssChannelAdapter", "newKeyboardHandler", "nbytes", "controller", "value", "clk", "xtra", "category", "AY38910_Audio", "j", "x", "rgb2bgr", "ASTROLIBRE_BIOS_LZG", "ASTROCADE_PRESETS", "ASTROCADE_BIOS_PRESETS", "ASTROCADE_ARCADE_PRESETS", "BallyAstrocadePlatform", "BaseZ80MachinePlatform", "BallyAstrocade", "a", "BallyAstrocadeBIOSPlatform", "title", "rom", "BallyArcadePlatform", "PLATFORMS"]
}

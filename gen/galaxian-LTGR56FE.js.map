{
  "version": 3,
  "sources": ["../src/machine/galaxian.ts", "../src/platform/galaxian.ts"],
  "sourcesContent": ["\nimport { Z80, Z80State } from \"../common/cpu/ZilogZ80\";\nimport { BasicScanlineMachine } from \"../common/devices\";\nimport { KeyFlags, newAddressDecoder, padBytes, noise, Keys, makeKeycodeMap, newKeyboardHandler, EmuHalt } from \"../common/emu\";\nimport { TssChannelAdapter, MasterAudio, AY38910_Audio } from \"../common/audio\";\nimport { hex } from \"../common/util\";\n\nconst GALAXIAN_KEYCODE_MAP = makeKeycodeMap([\n    [Keys.A, 0, 0x10], // P1\n    [Keys.LEFT, 0, 0x4],\n    [Keys.RIGHT, 0, 0x8],\n    [Keys.P2_A, 1, 0x10], // P2\n    [Keys.P2_LEFT, 1, 0x4],\n    [Keys.P2_RIGHT, 1, 0x8],\n    [Keys.SELECT, 0, 0x1],\n    [Keys.START, 1, 0x1],\n    [Keys.VK_2, 1, 0x2],\n]);\n\nconst SCRAMBLE_KEYCODE_MAP = makeKeycodeMap([\n    [Keys.UP, 0, -0x1], // P1\n    [Keys.B, 0, -0x2], // fire\n    [Keys.VK_7, 0, -0x4], // credit\n    [Keys.A, 0, -0x8], // bomb\n    [Keys.RIGHT, 0, -0x10],\n    [Keys.LEFT, 0, -0x20],\n    [Keys.VK_6, 0, -0x40],\n    [Keys.SELECT, 0, -0x80],\n    [Keys.START, 1, -0x80],\n    [Keys.VK_2, 1, -0x40],\n    [Keys.DOWN, 2, -0x40],\n    //[Keys.VK_UP,    2, -0x10],\n]);\n\nconst bitcolors = [\n    0x000021, 0x000047, 0x000097, // red\n    0x002100, 0x004700, 0x009700, // green\n    0x510000, 0xae0000            // blue\n];\n\nconst GalaxianVideo = function (rom: Uint8Array, vram: Uint8Array, oram: Uint8Array, palette: Uint32Array, options) {\n\n    var gfxBase = options.gfxBase || 0x2800;\n    this.missileWidth = options.missileWidth || 4;\n    this.missileOffset = options.missileOffset || 0;\n    this.showOffscreenObjects = false;\n    this.frameCounter = 0;\n    this.starsEnabled = 0;\n    var stars = [];\n    for (var i = 0; i < 256; i++)\n        stars[i] = noise();\n\n    this.advanceFrame = function () {\n        this.frameCounter = (this.frameCounter + 1) & 0xff;\n    }\n\n    this.drawScanline = function (pixels, sl) {\n        var pixofs = sl * 264;\n        // hide offscreen on left + right (b/c rotated)\n        if (!this.showOffscreenObjects && (sl < 16 || sl >= 240)) {\n            for (var i = 0; i < 264; i++)\n                pixels[pixofs + i] = 0xff000000;\n            return; // offscreen\n        }\n        // draw tiles\n        var outi = pixofs; // starting output pixel in frame buffer\n        for (var xx = 0; xx < 32; xx++) {\n            var xofs = xx;\n            var scroll = oram[xofs * 2]; // even entries control scroll position\n            var attrib = oram[xofs * 2 + 1]; // odd entries control the color base\n            var sl2 = (sl + scroll) & 0xff;\n            var vramofs = (sl2 >> 3) << 5; // offset in VRAM\n            var yy = sl2 & 7; // y offset within tile\n            var tile = vram[vramofs + xofs]; // TODO: why undefined?\n            var color0 = (attrib & 7) << 2;\n            var addr = gfxBase + (tile << 3) + yy;\n            var data1 = rom[addr];\n            var data2 = rom[addr + 0x800];\n            for (var i = 0; i < 8; i++) {\n                var bm = 128 >> i;\n                var color = color0 + ((data1 & bm) ? 1 : 0) + ((data2 & bm) ? 2 : 0);\n                pixels[outi] = palette[color];\n                outi++;\n            }\n        }\n        // draw sprites\n        for (var sprnum = 7; sprnum >= 0; sprnum--) {\n            var base = (sprnum << 2) + 0x40;\n            var base0 = oram[base];\n            var sy = 240 - (base0 - ((sprnum < 3) ? 1 : 0)); // the first three sprites match against y-1\n            var yy = (sl - sy);\n            if (yy >= 0 && yy < 16) {\n                var sx = oram[base + 3] + 1; // +1 pixel offset from tiles\n                if (sx == 0 && !this.showOffscreenObjects) {\n                    continue; // drawn off-buffer\n                }\n                var code = oram[base + 1];\n                var flipx = code & 0x40; // TODO: flipx\n                if (code & 0x80) // flipy\n                    yy = 15 - yy;\n                code &= 0x3f;\n                var color0 = (oram[base + 2] & 7) << 2;\n                var addr = gfxBase + (code << 5) + (yy < 8 ? yy : yy + 8);\n                outi = pixofs + sx; //<< 1\n                var data1 = rom[addr];\n                var data2 = rom[addr + 0x800];\n                for (var i = 0; i < 8; i++) {\n                    var bm = 128 >> i;\n                    var color = ((data1 & bm) ? 1 : 0) + ((data2 & bm) ? 2 : 0);\n                    if (color)\n                        pixels[flipx ? (outi + 15 - i) : (outi + i)] = palette[color0 + color];\n                }\n                var data1 = rom[addr + 8];\n                var data2 = rom[addr + 0x808];\n                for (var i = 0; i < 8; i++) {\n                    var bm = 128 >> i;\n                    var color = ((data1 & bm) ? 1 : 0) + ((data2 & bm) ? 2 : 0);\n                    if (color)\n                        pixels[flipx ? (outi + 7 - i) : (outi + i + 8)] = palette[color0 + color];\n                }\n            }\n        }\n        // draw bullets/shells\n        var shell = 0xff;\n        var missile = 0xff;\n        for (var which = 0; which < 8; which++) {\n            var sy = oram[0x60 + (which << 2) + 1];\n            if (((sy + sl - ((which < 3) ? 1 : 0)) & 0xff) == 0xff) {\n                if (which != 7)\n                    shell = which;\n                else\n                    missile = which;\n            }\n        }\n        for (var i = 0; i < 2; i++) {\n            which = i ? missile : shell;\n            if (which != 0xff) {\n                var sx = 255 - oram[0x60 + (which << 2) + 3];\n                var outi = pixofs + sx - this.missileOffset;\n                var col = which == 7 ? 0xffffff00 : 0xffffffff;\n                for (var j = 0; j < this.missileWidth; j++)\n                    pixels[outi++] = col;\n            }\n        }\n        // draw stars\n        if (this.starsEnabled) {\n            var starx = ((this.frameCounter + stars[sl & 0xff]) & 0xff);\n            if ((starx + sl) & 0x10) {\n                var outi = pixofs + starx;\n                if ((pixels[outi] & 0xffffff) == 0) {\n                    pixels[outi] = palette[sl & 0x1f];\n                }\n            }\n        }\n    }\n\n}\n\nconst XTAL = 18432000.0;\nconst scanlinesPerFrame = 264;\nconst cpuFrequency = XTAL / 6; // 3.072 MHz\nconst hsyncFrequency = XTAL / 3 / 192 / 2; // 16 kHz\nconst vsyncFrequency = hsyncFrequency / 132 / 2; // 60.606060 Hz\nconst vblankDuration = 1 / vsyncFrequency * (20 / 132); // 2500 us\nconst cpuCyclesPerLine = cpuFrequency / hsyncFrequency;\nconst INITIAL_WATCHDOG = 8;\n\nconst audioOversample = 2;\nconst audioSampleRate = 60 * scanlinesPerFrame; // why not hsync?\n\nexport class GalaxianMachine extends BasicScanlineMachine {\n\n    options = {};\n    palBase = 0x3800;\n    keyMap = GALAXIAN_KEYCODE_MAP;\n\n    cpuFrequency = cpuFrequency;\n    canvasWidth = 264;\n    numTotalScanlines = 264;\n    numVisibleScanlines = 264;\n    defaultROMSize = 0x4000;\n    sampleRate = audioSampleRate * audioOversample;\n    cpuCyclesPerLine = cpuCyclesPerLine | 0;\n    rotate = 90;\n\n    cpu: Z80 = new Z80();\n    ram = new Uint8Array(0x800);\n    vram = new Uint8Array(0x400);\n    oram = new Uint8Array(0x100);\n    palette: Uint32Array;\n    gfx; // GalaxianVideo\n    audioadapter;\n    psg1: AY38910_Audio;\n    psg2: AY38910_Audio;\n    watchdog_counter: number = 0;\n    interruptEnabled: number = 0;\n    defaultInputs: number[] = [0xe, 0x8, 0x0];\n\n    constructor() {\n        super();\n        var audio = new MasterAudio();\n        this.psg1 = new AY38910_Audio(audio);\n        this.psg2 = new AY38910_Audio(audio);\n        this.audioadapter = new TssChannelAdapter([this.psg1.psg, this.psg2.psg], audioOversample, this.sampleRate);\n        this.init();\n    }\n\n    init() {\n        this.rom = new Uint8Array(this.defaultROMSize);\n        this.palette = new Uint32Array(new ArrayBuffer(32 * 4));\n        this.gfx = new GalaxianVideo(this.rom, this.vram, this.oram, this.palette, this.options);\n        this.connectCPUMemoryBus(this);\n        this.connectCPUIOBus(this.newIOBus());\n        this.inputs.set(this.defaultInputs);\n        this.handler = newKeyboardHandler(this.inputs, this.keyMap);\n    }\n\n    read = newAddressDecoder([\n        [0x0000, 0x3fff, 0, (a) => { return this.rom ? this.rom[a] : null; }],\n        [0x4000, 0x47ff, 0x3ff, (a) => { return this.ram[a]; }],\n        [0x5000, 0x57ff, 0x3ff, (a) => { return this.vram[a]; }],\n        [0x5800, 0x5fff, 0xff, (a) => { return this.oram[a]; }],\n        [0x6000, 0x6000, 0, (a) => { return this.inputs[0]; }],\n        [0x6800, 0x6800, 0, (a) => { return this.inputs[1]; }],\n        [0x7000, 0x7000, 0, (a) => { return this.inputs[2]; }],\n        [0x7800, 0x7800, 0, (a) => { this.watchdog_counter = INITIAL_WATCHDOG; }],\n    ]);\n    \n    readConst(a : number) {\n        return (a < 0x7000) ? this.read(a) : null;\n    }\n\n    write = newAddressDecoder([\n        [0x4000, 0x47ff, 0x3ff, (a, v) => { this.ram[a] = v; }],\n        [0x5000, 0x57ff, 0x3ff, (a, v) => { this.vram[a] = v; }],\n        [0x5800, 0x5fff, 0xff, (a, v) => { this.oram[a] = v; }],\n        //[0x6004, 0x6007, 0x3,    function(a,v) => { }], // lfo freq\n        //[0x6800, 0x6807, 0x7,    function(a,v) => { }], // sound\n        //[0x7800, 0x7800, 0x7,    function(a,v) => { }], // pitch\n        //[0x6000, 0x6003, 0x3, (a, v) => { this.outlatches[a] = v; }],\n        [0x7001, 0x7001, 0, (a, v) => { this.interruptEnabled = v & 1; }],\n        [0x7004, 0x7004, 0, (a, v) => { this.gfx.starsEnabled = v & 1; }],\n    ]);\n\n    newIOBus() {\n        return {\n            read: (addr) => {\n                return 0;\n            },\n            write: (addr, val) => {\n                if (addr & 0x1) { this.psg1.selectRegister(val & 0xf); };\n                if (addr & 0x2) { this.psg1.setData(val); };\n                if (addr & 0x4) { this.psg2.selectRegister(val & 0xf); };\n                if (addr & 0x8) { this.psg2.setData(val); };\n            }\n        };\n    }\n\n    reset() {\n        super.reset();\n        this.psg1.reset();\n        this.psg2.reset();\n        this.watchdog_counter = INITIAL_WATCHDOG;\n    }\n\n    startScanline() {\n        this.audio && this.audioadapter && this.audioadapter.generate(this.audio);\n    }\n\n    drawScanline() {\n        this.gfx.drawScanline(this.pixels, this.scanline);\n    }\n\n    advanceFrame(trap) {\n        var steps = super.advanceFrame(trap);\n\n        // advance graphics\n        this.gfx.advanceFrame();\n        // clear bottom of screen?\n        if (!this.gfx.showOffscreenObjects) {\n            for (var i = 0; i < 264; i++)\n                this.pixels.fill(0xff000000, 256 + i * 264, 264 + i * 264);\n        }\n        // watchdog fired?\n        if (this.watchdog_counter-- <= 0) {\n            throw new EmuHalt(\"WATCHDOG FIRED\");\n        }\n        // NMI interrupt @ 0x66\n        if (this.interruptEnabled) { this.cpu.NMI(); }\n\n        return steps;\n    }\n\n    loadROM(data) {\n        this.rom.set(padBytes(data, this.defaultROMSize));\n        for (var i = 0; i < 32; i++) {\n            var b = this.rom[this.palBase + i];\n            this.palette[i] = 0xff000000;\n            for (var j = 0; j < 8; j++)\n                if (((1 << j) & b))\n                    this.palette[i] += bitcolors[j];\n        }\n    }\n\n    loadState(state) {\n        super.loadState(state);\n        this.vram.set(state.bv);\n        this.oram.set(state.bo);\n        this.watchdog_counter = state.wdc;\n        this.interruptEnabled = state.ie;\n        this.gfx.starsEnabled = state.se;\n        this.gfx.frameCounter = state.fc;\n    }\n\n    saveState() {\n        var state = super.saveState();\n        state['bv'] = this.vram.slice(0);\n        state['bo'] = this.oram.slice(0);\n        state['fc'] = this.gfx.frameCounter;\n        state['ie'] = this.interruptEnabled;\n        state['se'] = this.gfx.starsEnabled;\n        state['wdc'] = this.watchdog_counter;\n        return state;\n    }\n\n}\n\nexport class GalaxianScrambleMachine extends GalaxianMachine {\n\n    defaultROMSize = 0x5020;\n    palBase = 0x5000;\n    scramble = true;\n    keyMap = SCRAMBLE_KEYCODE_MAP;\n    options = {\n        gfxBase: 0x4000,\n        missileWidth: 1,\n        missileOffset: 6,\n    };\n    defaultInputs = [0xff, 0xfc, 0xf1];\n\n    constructor() {\n        super();\n        this.init(); // TODO: why do we have to call twice?\n    }\n\n    read = newAddressDecoder([\n        [0x0000, 0x3fff, 0, (a) => { return this.rom[a]; }],\n        [0x4000, 0x47ff, 0x7ff, (a) => { return this.ram[a]; }],\n        [0x4800, 0x4fff, 0x3ff, (a) => { return this.vram[a]; }],\n        [0x5000, 0x5fff, 0xff, (a) => { return this.oram[a]; }],\n        [0x7000, 0x7000, 0, (a) => { this.watchdog_counter = INITIAL_WATCHDOG; }],\n        [0x7800, 0x7800, 0, (a) => { this.watchdog_counter = INITIAL_WATCHDOG; }],\n        //[0x8000, 0x820f, 0,      function(a) { return noise(); }], // TODO: remove\n        [0x8100, 0x8100, 0, (a) => { return this.inputs[0]; }],\n        [0x8101, 0x8101, 0, (a) => { return this.inputs[1]; }],\n        [0x8102, 0x8102, 0, (a) => { return this.inputs[2] | this.scramble_protection_alt_r(); }],\n        [0x8202, 0x8202, 0, (a) => { return this.m_protection_result; }], // scramble (protection)\n        [0x9100, 0x9100, 0, (a) => { return this.inputs[0]; }],\n        [0x9101, 0x9101, 0, (a) => { return this.inputs[1]; }],\n        [0x9102, 0x9102, 0, (a) => { return this.inputs[2] | this.scramble_protection_alt_r(); }],\n        [0x9212, 0x9212, 0, (a) => { return this.m_protection_result; }], // scramble (protection)\n        //[0, 0xffff, 0, function(a) { console.log(hex(a)); return 0; }]\n    ]);\n    write = newAddressDecoder([\n        [0x4000, 0x47ff, 0x7ff, (a, v) => { this.ram[a] = v; }],\n        [0x4800, 0x4fff, 0x3ff, (a, v) => { this.vram[a] = v; }],\n        [0x5000, 0x5fff, 0xff, (a, v) => { this.oram[a] = v; }],\n        [0x6801, 0x6801, 0, (a, v) => { this.interruptEnabled = v & 1; /*console.log(a,v,cpu.getPC().toString(16));*/ }],\n        [0x6802, 0x6802, 0, (a, v) => { /* TODO: coin counter */ }],\n        [0x6803, 0x6803, 0, (a, v) => { /* TODO: backgroundColor = (v & 1) ? 0xFF000056 : 0xFF000000; */ }],\n        [0x6804, 0x6804, 0, (a, v) => { this.gfx.starsEnabled = v & 1; }],\n        [0x6808, 0x6808, 0, (a, v) => { this.gfx.missileWidth = v; }], // not on h/w\n        [0x6809, 0x6809, 0, (a, v) => { this.gfx.missileOffset = v; }], // not on h/w\n        [0x8202, 0x8202, 0, this.scramble_protection_w.bind(this)],\n        //[0x8100, 0x8103, 0, function(a,v){ /* PPI 0 */ }],\n        //[0x8200, 0x8203, 0, function(a,v){ /* PPI 1 */ }],\n        //[0, 0xffff, 0, function(a,v) { console.log(hex(a),hex(v)); }]\n    ]);\n\n    m_protection_state = 0;\n    m_protection_result = 0;\n    scramble_protection_w(addr, data) {\n        /*\n            This is not fully understood; the low 4 bits of port C are\n            inputs; the upper 4 bits are outputs. Scramble main set always\n            writes sequences of 3 or more nibbles to the low port and\n            expects certain results in the upper nibble afterwards.\n        */\n        this.m_protection_state = (this.m_protection_state << 4) | (data & 0x0f);\n        switch (this.m_protection_state & 0xfff) {\n            /* scramble */\n            case 0xf09: this.m_protection_result = 0xff; break;\n            case 0xa49: this.m_protection_result = 0xbf; break;\n            case 0x319: this.m_protection_result = 0x4f; break;\n            case 0x5c9: this.m_protection_result = 0x6f; break;\n\n            /* scrambls */\n            case 0x246: this.m_protection_result ^= 0x80; break;\n            case 0xb5f: this.m_protection_result = 0x6f; break;\n        }\n    }\n    scramble_protection_alt_r() {\n        var bit = (this.m_protection_result >> 7) & 1;\n        return (bit << 5) | ((bit ^ 1) << 7);\n    }\n}\n", "\nimport { Platform } from \"../common/baseplatform\";\nimport { PLATFORMS } from \"../common/emu\";\nimport { GalaxianMachine, GalaxianScrambleMachine } from \"../machine/galaxian\";\nimport { BaseZ80MachinePlatform } from \"../common/baseplatform\";\n\nconst GALAXIAN_PRESETS = [\n  { id: 'gfxtest.c', name: 'Graphics Test' },\n  { id: 'shoot2.c', name: 'Solarian Game' },\n];\n\nclass GalaxianPlatform extends BaseZ80MachinePlatform<GalaxianMachine> implements Platform {\n\n  newMachine()          { return new GalaxianMachine(); }\n  getPresets()          { return GALAXIAN_PRESETS; }\n  getDefaultExtension() { return \".c\"; };\n  readAddress(a)        { return this.machine.readConst(a); }\n  readVRAMAddress(a)    { return (a < 0x800) ? this.machine.vram[a] : this.machine.oram[a-0x800]; }\n  // TODO loadBIOS(bios)\t{ this.machine.loadBIOS(a); }\n  getMemoryMap = function() { return { main:[\n    {name:'Video RAM',start:0x5000,size:0x400,type:'ram'},\n    {name:'Sprite RAM',start:0x5800,size:0x100,type:'ram'},\n    {name:'I/O Registers',start:0x6000,size:0x2000,type:'io'},\n  ] } };\n  showHelp() { return \"https://8bitworkshop.com/docs/platforms/arcade/index.html#galaxian-scramble\" }\n}\n\nclass GalaxianScramblePlatform extends GalaxianPlatform implements Platform {\n\n  newMachine()          { return new GalaxianScrambleMachine(); }\n\n}\n\nPLATFORMS['galaxian'] = GalaxianPlatform;\nPLATFORMS['galaxian-scramble'] = GalaxianScramblePlatform;\n"],
  "mappings": "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",
  "names": ["GALAXIAN_KEYCODE_MAP", "makeKeycodeMap", "Keys", "SCRAMBLE_KEYCODE_MAP", "bitcolors", "GalaxianVideo", "rom", "vram", "oram", "palette", "options", "gfxBase", "stars", "i", "noise", "pixels", "sl", "pixofs", "outi", "xx", "xofs", "scroll", "attrib", "sl2", "vramofs", "yy", "tile", "color0", "addr", "data1", "data2", "bm", "color", "sprnum", "base", "base0", "sy", "sx", "code", "flipx", "shell", "missile", "which", "col", "j", "starx", "XTAL", "scanlinesPerFrame", "cpuFrequency", "hsyncFrequency", "vsyncFrequency", "vblankDuration", "cpuCyclesPerLine", "INITIAL_WATCHDOG", "audioOversample", "audioSampleRate", "GalaxianMachine", "BasicScanlineMachine", "Z80", "newAddressDecoder", "a", "v", "audio", "MasterAudio", "AY38910_Audio", "TssChannelAdapter", "newKeyboardHandler", "val", "trap", "steps", "EmuHalt", "data", "padBytes", "b", "state", "GalaxianScrambleMachine", "bit", "GALAXIAN_PRESETS", "GalaxianPlatform", "BaseZ80MachinePlatform", "GalaxianMachine", "a", "GalaxianScramblePlatform", "GalaxianScrambleMachine", "PLATFORMS"]
}
